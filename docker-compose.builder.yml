version: '3.4'

services:

  bcoin:
    build:
      context: .
      dockerfile: bcoin.Dockerfile
    restart: always
    ports:
      - "48332:48332"
      - "48333:48333"
    environment:
      BCOIN_CONFIG: /conf/bcoin.conf
      VIRTUAL_HOST: localhost
      VIRTUAL_PORT: 48332
    volumes:
      - ./.bcoin:/data
      - ./support/bcoin/bcoin.conf:/conf/bcoin.conf

  ganache:
    image: trufflesuite/ganache-cli:latest
    ports:
      - "8545:8545"
    command: "--host 0.0.0.0 --mnemonic \"finish oppose decorate face calm tragic certain desk hour urge dinosaur mango\""

  # install:
  #   image: node:9-alpine
  #   environment:
  #     - NPM_TOKEN=${NPM_TOKEN}
  #   volumes:
  #     - .:/usr/src/service
  #     # - /usr/local/lib/node_modules:/usr/local/lib/node_modules
  #     # - /usr/local/lib/node_modules/@gridplus/mqtt-client:/usr/local/lib/node_modules/@gridplus/mqtt-client
  #   working_dir: /usr/src/service
  #   privileged: true
  #   user: node
  #   command: /usr/local/bin/npm i

  # test:
  #   image: node:9-alpine
  #   environment:
  #     - NPM_TOKEN=${NPM_TOKEN}
  #   volumes:
  #     - .:/usr/src/service
  #     # - /usr/local/lib/node_modules:/usr/local/lib/node_modules
  #     # - /usr/local/lib/node_modules/@gridplus/mqtt-client:/usr/local/lib/node_modules/@gridplus/mqtt-client
  #   working_dir: /usr/src/service
  #   privileged: true
  #   user: node
  #   command: /usr/local/bin/npm test